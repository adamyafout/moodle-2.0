{"version":3,"sources":["../src/submissionhelper.js"],"names":["define","$","log","cloudpoodll","str","debug","uploadstate","togglestate","strings","init","opts","component","safesave","register_controls","register_events","setup_recorder","that","recorder_callback","evt","type","action","controls","updatecontrol","val","formsubmitbutton","attr","mediaurl","removeAttr","alert","message","deletebutton","currentcontainer","togglecontainer","togglebutton","toggletext","get_string","done","s","click","confirm","M","util","html","toggle_currentsubmission","toggle","duration","complete","doToggleState","removeClass","addClass","text"],"mappings":"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","sourcesContent":["define(['jquery','core/log','assignsubmission_cloudpoodll/cloudpoodllloader',\"core/str\"], function($,log,cloudpoodll,str) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('submission helper: initialising');\n\n    return {\n\n        uploadstate: false,\n        togglestate: 0,\n        strings: {},\n\n\n        init:  function(opts) {\n            this.component = opts['component'];\n            this.safesave=opts['safesave'];\n\n            this.register_controls();\n            this.register_events();\n            this.setup_recorder();\n        },\n\n        setup_recorder: function(){\n            var that = this;\n            var recorder_callback = function(evt){\n                switch(evt.type){\n                    case 'recording':\n                        if(evt.action==='started'){\n                            that.controls.updatecontrol.val();\n                            //if opts safe save\n                            if(that.safesave==1) {\n                                that.controls.formsubmitbutton.attr('disabled', 'disabled');\n                            }\n                        }\n                        break;\n                    case 'awaitingprocessing':\n                        if(that.uploadstate!='posted') {\n                            that.controls.updatecontrol.val(evt.mediaurl);\n                            //if opts safe save\n                            if(that.safesave==1) {\n                                that.controls.formsubmitbutton.removeAttr('disabled', 'disabled');\n                            }\n                        }\n                        that.uploadstate='posted';\n                        break;\n                    case 'error':\n                        alert('PROBLEM:' + evt.message);\n                        break;\n                }\n            };\n            cloudpoodll.init(this.component + '_therecorder',recorder_callback);\n        },\n\n\n        register_controls: function(){\n          var that=this;\n          this.controls={};\n          this.controls.formsubmitbutton = $('#id_submitbutton');\n          this.controls.deletebutton = $('.' + this.component + '_deletesubmissionbutton');\n          this.controls.updatecontrol =  $('#' + this.component + '_updatecontrol');\n          this.controls.currentcontainer =  $('.' + this.component + '_currentsubmission');\n          this.controls.togglecontainer =  $('.' + this.component + '_togglecontainer');\n          this.controls.togglebutton =  $('.' + this.component + '_togglecontainer .togglebutton');\n          this.controls.toggletext =  $('.' + this.component + '_togglecontainer .toggletext');\n            str.get_string('clicktohide',that.component).done(function(s) {\n                that.strings['clicktohide']=s;\n            });\n            str.get_string('clicktoshow',that.component).done(function(s) {\n                that.strings['clicktoshow']=s;\n            });\n        },\n\n        register_events: function(){\n            var that =this;\n            this.controls.deletebutton.click(function(){\n                if(that.controls.updatecontrol){\n                    if(confirm(M.util.get_string('reallydeletesubmission',that.component))){\n                        that.controls.updatecontrol.val(-1);\n                        that.controls.currentcontainer.html('');\n                    }\n                }\n            });\n            this.controls.togglebutton.click(function(){that.toggle_currentsubmission(that);});\n            this.controls.toggletext.click(function(){that.toggle_currentsubmission(that);});\n        },\n\n        toggle_currentsubmission: function(that){\n            var doToggleState = function(){\n                if(that.togglestate==0){\n                    that.controls.togglebutton.removeClass('fa-toggle-off');\n                    that.controls.togglebutton.addClass('fa-toggle-on');\n                    that.controls.toggletext.text(that.strings['clicktohide']);\n                    that.togglestate=1;\n                }else{\n                    that.controls.togglebutton.removeClass('fa-toggle-on');\n                    that.controls.togglebutton.addClass('fa-toggle-off');\n                    that.controls.toggletext.text(that.strings['clicktoshow']);\n                    that.togglestate=0;\n                }\n            };\n            that.controls.currentcontainer.toggle(\n                {duration: 300, complete: doToggleState}\n            );\n            return false;\n        }\n    };//end of return object\n});"],"file":"submissionhelper.min.js"}